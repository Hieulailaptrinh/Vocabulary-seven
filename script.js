// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG (MOCK DATA) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG C·ª¶A B·∫†N (80 T·ª™) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 4) ---

// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 3) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 5) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 6) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 7) ---
const vocabularyData = [
  {
    id: 1,
    word: "empty",
    ipa: "/Ààemp.ti/",
    meaning: "tr·ªëng / l√†m c·∫°n, ƒë·ªï h·∫øt",
    example: "The glass is empty.",
  },
  {
    id: 2,
    word: "examine",
    ipa: "/…™…°Ààz√¶m.…™n/",
    meaning: "ki·ªÉm tra, kh√°m x√©t",
    example: "The doctor examined the patient carefully.",
  },
  {
    id: 3,
    word: "restock",
    ipa: "/ÀåriÀêÀàst…ík/",
    meaning: "b·ªï sung l·∫°i h√†ng",
    example: "We need to restock the shelves.",
  },
  {
    id: 4,
    word: "rest",
    ipa: "/rest/",
    meaning: "ngh·ªâ ng∆°i",
    example: "You should go home and rest.",
  },
  {
    id: 5,
    word: "decorate",
    ipa: "/Ààdek.…ô.re…™t/",
    meaning: "trang tr√≠",
    example: "They decorated the room with flowers.",
  },
  {
    id: 6,
    word: "post",
    ipa: "/p…ô äst/",
    meaning: "ƒëƒÉng t·∫£i, g·ª≠i th∆∞",
    example: "He posted a photo on social media.",
  },
  {
    id: 7,
    word: "storage",
    ipa: "/Ààst…îÀê.r…™d í/",
    meaning: "kho, s·ª± l∆∞u tr·ªØ",
    example: "We put the old furniture in storage.",
  },
  {
    id: 8,
    word: "press release",
    ipa: "/Ààpres r…™ÀåliÀês/",
    meaning: "th√¥ng c√°o b√°o ch√≠",
    example: "The company issued a press release.",
  },
  {
    id: 9,
    word: "renew",
    ipa: "/r…™ÀànjuÀê/",
    meaning: "gia h·∫°n, l√†m m·ªõi",
    example: "I need to renew my passport.",
  },
  {
    id: 10,
    word: "newsletter",
    ipa: "/ÀànjuÀêzÀålet.…ôr/",
    meaning: "b·∫£n tin",
    example: "Subscribe to our monthly newsletter.",
  },
  {
    id: 11,
    word: "mention",
    ipa: "/Ààmen. É…ôn/",
    meaning: "nh·∫Øc ƒë·∫øn, ƒë·ªÅ c·∫≠p",
    example: "Did he mention the meeting?",
  },
  {
    id: 12,
    word: "shipment",
    ipa: "/Àà É…™p.m…ônt/",
    meaning: "s·ª± giao h√†ng, l√¥ h√†ng",
    example: "The shipment arrived late.",
  },
  {
    id: 13,
    word: "reschedule",
    ipa: "/ÀåriÀêÀà Éed í.uÀêl/",
    meaning: "d·ªùi l·∫°i l·ªãch",
    example: "Can we reschedule our appointment?",
  },
  {
    id: 14,
    word: "performance",
    ipa: "/p…ôÀàf…îÀê.m…ôns/",
    meaning: "m√†n tr√¨nh di·ªÖn, hi·ªáu su·∫•t",
    example: "Her performance was outstanding.",
  },
  {
    id: 15,
    word: "material",
    ipa: "/m…ôÀàt…™…ô.ri.…ôl/",
    meaning: "nguy√™n li·ªáu, v·∫≠t li·ªáu",
    example: "This material is very soft.",
  },
  {
    id: 16,
    word: "recipe",
    ipa: "/Ààres.…™.pi/",
    meaning: "c√¥ng th·ª©c (n·∫•u ƒÉn)",
    example: "Can I have the recipe for this cake?",
  },
  {
    id: 17,
    word: "loyal customer",
    ipa: "/Ààl…î…™.…ôl Ààk ås.t…ô.m…ôr/",
    meaning: "kh√°ch h√†ng trung th√†nh",
    example: "We offer discounts to loyal customers.",
  },
  {
    id: 18,
    word: "summary",
    ipa: "/Ààs åm.…ôr.i/",
    meaning: "t√≥m t·∫Øt",
    example: "Please write a brief summary of the book.",
  },
  {
    id: 19,
    word: "supply",
    ipa: "/s…ôÀàpla…™/",
    meaning: "s·ª± cung ·ª©ng, ngu·ªìn cung",
    example: "The water supply was cut off.",
  },
  {
    id: 20,
    word: "equipment",
    ipa: "/…™Ààkw…™p.m…ônt/",
    meaning: "thi·∫øt b·ªã",
    example: "The gym has new equipment.",
  },
  {
    id: 21,
    word: "fee",
    ipa: "/fiÀê/",
    meaning: "ph√≠, l·ªá ph√≠",
    example: "The entrance fee is $10.",
  },
  {
    id: 22,
    word: "malfunction",
    ipa: "/Àåm√¶lÀàf å≈ãk. É…ôn/",
    meaning: "s·ª± c·ªë, tr·ª•c tr·∫∑c",
    example: "The machine had a malfunction.",
  },
  {
    id: 23,
    word: "account",
    ipa: "/…ôÀàka änt/",
    meaning: "t√†i kho·∫£n",
    example: "I opened a new bank account.",
  },
  {
    id: 24,
    word: "last-minute",
    ipa: "/Àål…ëÀêst Ààm…™n.…™t/",
    meaning: "ph√∫t ch√≥t, ph√∫t cu·ªëi",
    example: "We made a last-minute decision.",
  },
  {
    id: 25,
    word: "luncheon",
    ipa: "/Ààl ån.t É…ôn/",
    meaning: "b·ªØa ti·ªác tr∆∞a",
    example: "We attended a charity luncheon.",
  },
  {
    id: 26,
    word: "r√©sum√©",
    ipa: "/Ààrez.juÀê.me…™/",
    meaning: "s∆° y·∫øu l√Ω l·ªãch (CV)",
    example: "Please send your r√©sum√© to HR.",
  },
  {
    id: 27,
    word: "colleague",
    ipa: "/Ààk…íl.iÀê…°/",
    meaning: "ƒë·ªìng nghi·ªáp",
    example: "I get along well with my colleagues.",
  },
  {
    id: 28,
    word: "construction",
    ipa: "/k…ônÀàstr åk. É…ôn/",
    meaning: "s·ª± x√¢y d·ª±ng",
    example: "The bridge is under construction.",
  },
  {
    id: 29,
    word: "present",
    ipa: "/Ààprez.…ônt/ (adj), /pr…™Ààzent/ (v)",
    meaning: "hi·ªán t·∫°i (adj) / thuy·∫øt tr√¨nh (v)",
    example: "He will present his findings tomorrow.",
  },
  {
    id: 30,
    word: "receipt",
    ipa: "/r…™ÀàsiÀêt/",
    meaning: "bi√™n lai, h√≥a ƒë∆°n",
    example: "Keep your receipt for the return.",
  },
  {
    id: 31,
    word: "monitor",
    ipa: "/Ààm…ín.…™.t…ôr/",
    meaning: "gi√°m s√°t / m√†n h√¨nh",
    example: "Teachers monitor the students during exams.",
  },
  {
    id: 32,
    word: "donate",
    ipa: "/d…ô äÀàne…™t/",
    meaning: "quy√™n g√≥p",
    example: "They donated clothes to the poor.",
  },
  {
    id: 33,
    word: "volunteer",
    ipa: "/Àåv…íl.…ônÀàt…™…ôr/",
    meaning: "t√¨nh nguy·ªán vi√™n",
    example: "She is a volunteer at the shelter.",
  },
  {
    id: 34,
    word: "bulletin board",
    ipa: "/Ààb äl.…ô.t…™n Àåb…îÀêd/",
    meaning: "b·∫£ng th√¥ng b√°o",
    example: "Check the bulletin board for news.",
  },
  {
    id: 35,
    word: "assist",
    ipa: "/…ôÀàs…™st/",
    meaning: "h·ªó tr·ª£",
    example: "Can I assist you with anything?",
  },
  {
    id: 36,
    word: "vendor",
    ipa: "/Ààven.d…ôr/",
    meaning: "ng∆∞·ªùi b√°n, nh√† cung c·∫•p",
    example: "We bought food from a street vendor.",
  },
  {
    id: 37,
    word: "coworker",
    ipa: "/Àåk…ô äÀàw…úÀê.k…ôr/",
    meaning: "ƒë·ªìng nghi·ªáp",
    example: "My coworker helped me finish the project.",
  },
  {
    id: 38,
    word: "management",
    ipa: "/Ààm√¶n.…™d í.m…ônt/",
    meaning: "s·ª± qu·∫£n l√Ω, ban qu·∫£n l√Ω",
    example: "The company has good management.",
  },
  {
    id: 39,
    word: "location",
    ipa: "/l…ô äÀàke…™. É…ôn/",
    meaning: "v·ªã tr√≠, ƒë·ªãa ƒëi·ªÉm",
    example: "This is a perfect location for a shop.",
  },
  {
    id: 40,
    word: "property",
    ipa: "/Ààpr…íp.…ô.ti/",
    meaning: "t√†i s·∫£n, b·∫•t ƒë·ªông s·∫£n",
    example: "This is private property.",
  },
  {
    id: 41,
    word: "value",
    ipa: "/Ààv√¶l.juÀê/",
    meaning: "gi√° tr·ªã",
    example: "The value of the house has increased.",
  },
  {
    id: 42,
    word: "refund",
    ipa: "/ÀàriÀê.f ånd/",
    meaning: "ho√†n ti·ªÅn / ti·ªÅn ho√†n l·∫°i",
    example: "I asked for a full refund.",
  },
  {
    id: 43,
    word: "postpone",
    ipa: "/p…ô ästÀàp…ô än/",
    meaning: "ho√£n l·∫°i",
    example: "The game was postponed due to rain.",
  },
  {
    id: 44,
    word: "review",
    ipa: "/r…™ÀàvjuÀê/",
    meaning: "ƒë√°nh gi√°, xem x√©t",
    example: "Please review the document carefully.",
  },
  {
    id: 45,
    word: "agenda",
    ipa: "/…ôÀàd íen.d…ô/",
    meaning: "ch∆∞∆°ng tr√¨nh ngh·ªã s·ª±",
    example: "What's on the agenda for today?",
  },
  {
    id: 46,
    word: "stock",
    ipa: "/st…ík/",
    meaning: "h√†ng t·ªìn, c·ªï phi·∫øu",
    example: "That item is out of stock.",
  },
  {
    id: 47,
    word: "accommodate",
    ipa: "/…ôÀàk…ím.…ô.de…™t/",
    meaning: "cung c·∫•p n∆°i ·ªü, ƒë√°p ·ª©ng",
    example: "The hotel can accommodate 500 guests.",
  },
  {
    id: 48,
    word: "stop by",
    ipa: "/st…íp ba…™/",
    meaning: "gh√© qua",
    example: "I will stop by your office later.",
  },
  {
    id: 49,
    word: "invoice",
    ipa: "/Àà…™n.v…î…™s/",
    meaning: "h√≥a ƒë∆°n",
    example: "Please pay the invoice within 30 days.",
  },
  {
    id: 50,
    word: "assure",
    ipa: "/…ôÀà É…îÀêr/",
    meaning: "ƒë·∫£m b·∫£o, tr·∫•n an",
    example: "I assure you that everything is fine.",
  },
  {
    id: 51,
    word: "accessible",
    ipa: "/…ôkÀàses.…ô.b…ôl/",
    meaning: "c√≥ th·ªÉ ti·∫øp c·∫≠n",
    example: "The building is accessible to wheelchair users.",
  },
  {
    id: 52,
    word: "reservation",
    ipa: "/Àårez.…ôÀàve…™. É…ôn/",
    meaning: "s·ª± ƒë·∫∑t ch·ªó",
    example: "I have a reservation at 7 PM.",
  },
  {
    id: 53,
    word: "detail",
    ipa: "/ÀàdiÀê.te…™l/",
    meaning: "chi ti·∫øt",
    example: "Tell me every detail of the story.",
  },
  {
    id: 54,
    word: "confirm",
    ipa: "/k…ônÀàf…úÀêm/",
    meaning: "x√°c nh·∫≠n",
    example: "Please confirm your email address.",
  },
  {
    id: 55,
    word: "proposal",
    ipa: "/pr…ôÀàp…ô ä.z…ôl/",
    meaning: "ƒë·ªÅ √°n, s·ª± ƒë·ªÅ xu·∫•t",
    example: "The committee rejected the proposal.",
  },
  {
    id: 56,
    word: "compete",
    ipa: "/k…ômÀàpiÀêt/",
    meaning: "c·∫°nh tranh, thi ƒë·∫•u",
    example: "Hundreds of athletes competed in the race.",
  },
  {
    id: 57,
    word: "equip",
    ipa: "/…™Ààkw…™p/",
    meaning: "trang b·ªã",
    example: "The lab is equipped with modern tools.",
  },
  {
    id: 58,
    word: "launch",
    ipa: "/l…îÀênt É/",
    meaning: "tung ra, ra m·∫Øt",
    example: "They launched a new marketing campaign.",
  },
  {
    id: 59,
    word: "participate",
    ipa: "/p…ëÀêÀàt…™s.…™.pe…™t/",
    meaning: "tham gia",
    example: "Everyone should participate in the discussion.",
  },
  {
    id: 60,
    word: "share",
    ipa: "/ Ée…ôr/",
    meaning: "chia s·∫ª, c·ªï ph·∫ßn",
    example: "She shared her food with me.",
  },
  {
    id: 61,
    word: "celebrate",
    ipa: "/Ààsel.…ô.bre…™t/",
    meaning: "ƒÉn m·ª´ng, k·ª∑ ni·ªám",
    example: "We celebrated his birthday yesterday.",
  },
  {
    id: 62,
    word: "progress",
    ipa: "/Ààpr…ô ä.…°res/",
    meaning: "s·ª± ti·∫øn b·ªô, ti·∫øn ƒë·ªô",
    example: "She is making good progress.",
  },
  {
    id: 63,
    word: "opportunity",
    ipa: "/Àå…íp.…ôÀàt ÉuÀê.n…ô.ti/",
    meaning: "c∆° h·ªôi",
    example: "Don't miss this opportunity.",
  },
  {
    id: 64,
    word: "at short notice",
    ipa: "/√¶t  É…îÀêt Ààn…ô ä.t…™s/",
    meaning: "g·∫•p g√°p, trong th·ªùi gian ng·∫Øn",
    example: "He canceled the meeting at short notice.",
  },
  {
    id: 65,
    word: "solution",
    ipa: "/s…ôÀàluÀê. É…ôn/",
    meaning: "gi·∫£i ph√°p",
    example: "We need to find a solution to this problem.",
  },
  {
    id: 66,
    word: "option",
    ipa: "/Àà…íp. É…ôn/",
    meaning: "s·ª± l·ª±a ch·ªçn",
    example: "You have two options.",
  },
  {
    id: 67,
    word: "instruction",
    ipa: "/…™nÀàstr åk. É…ôn/",
    meaning: "s·ª± h∆∞·ªõng d·∫´n",
    example: "Read the instructions before use.",
  },
  {
    id: 68,
    word: "issue",
    ipa: "/Àà…™ É.uÀê/",
    meaning: "v·∫•n ƒë·ªÅ / s·ªë b√°o",
    example: "Environmental issues are important.",
  },
  {
    id: 69,
    word: "patron",
    ipa: "/Ààpe…™.tr…ôn/",
    meaning: "kh√°ch quen, ng∆∞·ªùi b·∫£o tr·ª£",
    example: "He is a regular patron of this restaurant.",
  },
  {
    id: 70,
    word: "trade show",
    ipa: "/tre…™d  É…ô ä/",
    meaning: "tri·ªÉn l√£m th∆∞∆°ng m·∫°i",
    example: "We displayed our products at the trade show.",
  },
  {
    id: 71,
    word: "separate",
    ipa: "/Ààsep.…ôr.…ôt/",
    meaning: "ri√™ng bi·ªát, t√°ch r·ªùi",
    example: "They sleep in separate rooms.",
  },
  {
    id: 72,
    word: "advertisement",
    ipa: "/…ôdÀàv…úÀê.t…™s.m…ônt/",
    meaning: "qu·∫£ng c√°o",
    example: "I saw an advertisement for a new car.",
  },
  {
    id: 73,
    word: "satisfaction",
    ipa: "/Àås√¶t.…™sÀàf√¶k. É…ôn/",
    meaning: "s·ª± th·ªèa m√£n, h√†i l√≤ng",
    example: "Customer satisfaction is our priority.",
  },
  {
    id: 74,
    word: "stress",
    ipa: "/stres/",
    meaning: "s·ª± cƒÉng th·∫≥ng / nh·∫•n m·∫°nh",
    example: "He is under a lot of stress.",
  },
  {
    id: 75,
    word: "refreshments",
    ipa: "/r…™Ààfre É.m…ônts/",
    meaning: "ƒë·ªì ƒÉn th·ª©c u·ªëng nh·∫π",
    example: "Light refreshments will be served.",
  },
  {
    id: 76,
    word: "assign",
    ipa: "/…ôÀàsa…™n/",
    meaning: "ph√¢n c√¥ng, giao vi·ªác",
    example: "The teacher assigned homework to the class.",
  },
  {
    id: 77,
    word: "permit",
    ipa: "/p…ôÀàm…™t/ (v), /Ààp…úÀê.m…™t/ (n)",
    meaning: "cho ph√©p (v) / gi·∫•y ph√©p (n)",
    example: "Do you have a permit to park here?",
  },
  {
    id: 78,
    word: "supervisor",
    ipa: "/ÀàsuÀê.p…ô.va…™.z…ôr/",
    meaning: "ng∆∞·ªùi gi√°m s√°t",
    example: "My supervisor is very supportive.",
  },
  {
    id: 79,
    word: "government",
    ipa: "/Àà…° åv.…ô.m…ônt/",
    meaning: "ch√≠nh ph·ªß",
    example: "The government passed a new law.",
  },
  {
    id: 80,
    word: "forecast",
    ipa: "/Ààf…îÀê.k…ëÀêst/",
    meaning: "d·ª± b√°o",
    example: "The weather forecast predicts rain.",
  },
];
// ... (Ph·∫ßn danh s√°ch vocabularyData ·ªü tr√™n gi·ªØ nguy√™n) ...

// --- BI·∫æN TO√ÄN C·ª§C ---
let currentList = [...vocabularyData]; // T·∫°o b·∫£n sao ƒë·ªÉ thao t√°c (h·ªó tr·ª£ shuffle)
let currentIndex = 0;
let learnedWords = JSON.parse(localStorage.getItem("learnedWords")) || [];

// --- DOM ELEMENTS ---
const navItems = document.querySelectorAll("nav ul li");
const sections = document.querySelectorAll(".section");

// Flashcard Elements
const card = document.getElementById("flashcard");
const wordEl = document.getElementById("vocab-word");
const ipaEl = document.getElementById("vocab-ipa");
const meaningEl = document.getElementById("vocab-meaning");
const exampleEl = document.getElementById("vocab-example");
const countEl = document.getElementById("card-counter");
const btnNext = document.getElementById("btn-next");
const btnPrev = document.getElementById("btn-prev");
const btnSpeak = document.getElementById("btn-speak");
const btnMarkLearned = document.getElementById("btn-mark-learned");

// New Controls Elements
const jumpInput = document.getElementById("jump-input");
const btnJump = document.getElementById("btn-jump");
const btnShuffle = document.getElementById("btn-shuffle");

// Quiz Elements
const quizWord = document.getElementById("quiz-word");
const quizOptions = document.getElementById("quiz-options");
const quizFeedback = document.getElementById("quiz-feedback");
const btnNextQuiz = document.getElementById("btn-next-quiz");

// Progress Elements
const learnedCountEl = document.getElementById("learned-count");
const totalCountEl = document.getElementById("total-count");
const progressPercentEl = document.getElementById("progress-percent");
const btnReset = document.getElementById("btn-reset");

// --- H√ÄM KH·ªûI T·∫†O ---
function init() {
  setupNavigation();
  renderCard(currentIndex);
  updateProgressUI();
  loadQuiz();

  // ƒê·∫∑t gi·ªõi h·∫°n max cho √¥ input jump
  jumpInput.max = currentList.length;
}

// --- 1. LOGIC FLASHCARD (ƒê√£ c·∫≠p nh·∫≠t ƒë·ªÉ d√πng currentList) ---

function renderCard(index) {
  const data = currentList[index]; // L·∫•y d·ªØ li·ªáu t·ª´ danh s√°ch hi·ªán t·∫°i (ƒë√£/ch∆∞a shuffle)

  card.classList.remove("flipped");

  setTimeout(() => {
    wordEl.textContent = data.word;
    ipaEl.textContent = data.ipa;
    meaningEl.textContent = data.meaning;
    exampleEl.textContent = `"${data.example}"`;
    // Hi·ªÉn th·ªã s·ªë trang: Index + 1 / T·ªïng s·ªë
    countEl.textContent = `${index + 1} / ${currentList.length}`;

    // C·∫≠p nh·∫≠t gi√° tr·ªã √¥ input ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt ƒëang ·ªü ƒë√¢u
    jumpInput.value = index + 1;

    // Ki·ªÉm tra tr·∫°ng th√°i ƒë√£ h·ªçc (d·ª±a tr√™n ID g·ªëc c·ªßa t·ª´)
    if (learnedWords.includes(data.id)) {
      btnMarkLearned.textContent = "‚úÖ ƒê√£ thu·ªôc (ƒê√£ l∆∞u)";
      btnMarkLearned.disabled = true;
      btnMarkLearned.style.opacity = "0.6";
    } else {
      btnMarkLearned.textContent = "‚úÖ ƒê√°nh d·∫•u ƒë√£ thu·ªôc";
      btnMarkLearned.disabled = false;
      btnMarkLearned.style.opacity = "1";
    }
  }, 200);
}

// L·∫≠t th·∫ª
card.addEventListener("click", () => card.classList.toggle("flipped"));

// Next / Prev
btnNext.addEventListener("click", (e) => {
  e.stopPropagation();
  if (currentIndex < currentList.length - 1) {
    currentIndex++;
    renderCard(currentIndex);
  }
});

btnPrev.addEventListener("click", (e) => {
  e.stopPropagation();
  if (currentIndex > 0) {
    currentIndex--;
    renderCard(currentIndex);
  }
});

// Text to Speech
btnSpeak.addEventListener("click", (e) => {
  e.stopPropagation();
  const utterance = new SpeechSynthesisUtterance(
    currentList[currentIndex].word
  );
  utterance.lang = "en-US";
  utterance.rate = 0.8;
  window.speechSynthesis.speak(utterance);
});

// ƒê√°nh d·∫•u ƒë√£ h·ªçc
btnMarkLearned.addEventListener("click", (e) => {
  e.stopPropagation();
  const currentId = currentList[currentIndex].id;
  if (!learnedWords.includes(currentId)) {
    learnedWords.push(currentId);
    saveProgress();
    renderCard(currentIndex);
    updateProgressUI();
  }
});

// --- T√çNH NƒÇNG M·ªöI: JUMP & SHUFFLE ---

// 1. Ch·ª©c nƒÉng Nh·∫£y ƒë·∫øn trang (Jump)
btnJump.addEventListener("click", () => {
  const pageNumber = parseInt(jumpInput.value);

  if (pageNumber >= 1 && pageNumber <= currentList.length) {
    currentIndex = pageNumber - 1; // V√¨ m·∫£ng b·∫Øt ƒë·∫ßu t·ª´ 0
    renderCard(currentIndex);
  } else {
    alert(`Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn ${currentList.length}`);
  }
});

// Cho ph√©p ·∫•n Enter trong √¥ input
jumpInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") btnJump.click();
});

// 2. Ch·ª©c nƒÉng X√°o tr·ªôn (Shuffle)
btnShuffle.addEventListener("click", () => {
  // Thu·∫≠t to√°n Fisher-Yates Shuffle
  for (let i = currentList.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [currentList[i], currentList[j]] = [currentList[j], currentList[i]];
  }

  // Reset v·ªÅ th·∫ª ƒë·∫ßu ti√™n sau khi tr·ªôn
  currentIndex = 0;
  renderCard(currentIndex);

  // Hi·ªáu ·ª©ng th√¥ng b√°o nh·ªè
  const originalText = btnShuffle.innerText;
  btnShuffle.innerText = "ƒê√£ tr·ªôn xong!";
  setTimeout(() => {
    btnShuffle.innerText = originalText;
  }, 1500);
});

// --- C√ÅC PH·∫¶N C√íN L·∫†I (GI·ªÆ NGUY√äN) ---

function setupNavigation() {
  navItems.forEach((item) => {
    item.addEventListener("click", () => {
      navItems.forEach((nav) => nav.classList.remove("active"));
      item.classList.add("active");
      const targetId = item.getAttribute("data-target");
      sections.forEach((sec) => sec.classList.remove("active-section"));
      document.getElementById(targetId).classList.add("active-section");
    });
  });
}
window.navigateTo = (targetId) =>
  document.querySelector(`nav ul li[data-target="${targetId}"]`).click();

// Quiz Logic
function loadQuiz() {
  quizFeedback.textContent = "";
  quizOptions.innerHTML = "";
  btnNextQuiz.style.display = "none";

  // V·∫´n d√πng vocabularyData g·ªëc cho quiz ƒë·ªÉ ƒë·∫£m b·∫£o ng·∫´u nhi√™n ƒë·ªôc l·∫≠p v·ªõi flashcard
  const correctData =
    vocabularyData[Math.floor(Math.random() * vocabularyData.length)];
  quizWord.textContent = correctData.word;

  let options = [correctData];
  while (options.length < 4) {
    const randomItem =
      vocabularyData[Math.floor(Math.random() * vocabularyData.length)];
    if (!options.includes(randomItem)) options.push(randomItem);
  }
  options.sort(() => Math.random() - 0.5);

  options.forEach((opt) => {
    const btn = document.createElement("button");
    btn.classList.add("option-btn");
    btn.textContent = opt.meaning;
    btn.onclick = () => checkAnswer(opt.id, correctData.id, btn);
    quizOptions.appendChild(btn);
  });
}

function checkAnswer(selectedId, correctId, btnElement) {
  const allBtns = document.querySelectorAll(".option-btn");
  allBtns.forEach((b) => (b.disabled = true));
  if (selectedId === correctId) {
    btnElement.classList.add("correct");
    quizFeedback.textContent = "Ch√≠nh x√°c! üéâ";
    quizFeedback.style.color = "var(--success)";
  } else {
    btnElement.classList.add("wrong");
    quizFeedback.textContent = "Sai r·ªìi! üòÖ";
    quizFeedback.style.color = "var(--error)";
    allBtns.forEach((b) => {
      if (
        b.textContent === vocabularyData.find((v) => v.id === correctId).meaning
      )
        b.classList.add("correct");
    });
  }
  btnNextQuiz.style.display = "inline-block";
}
btnNextQuiz.addEventListener("click", loadQuiz);

// Progress Logic
function saveProgress() {
  localStorage.setItem("learnedWords", JSON.stringify(learnedWords));
}
function updateProgressUI() {
  const total = vocabularyData.length;
  const learned = learnedWords.length;
  const percent = Math.round((learned / total) * 100);
  learnedCountEl.textContent = learned;
  totalCountEl.textContent = total;
  progressPercentEl.textContent = `${percent}%`;
  progressPercentEl.style.color =
    percent === 100 ? "var(--success)" : "var(--primary)";
}
btnReset.addEventListener("click", () => {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô ti·∫øn ƒë·ªô h·ªçc kh√¥ng?")) {
    learnedWords = [];
    saveProgress();
    updateProgressUI();
    renderCard(currentIndex);
  }
});

// Ch·∫°y ·ª©ng d·ª•ng
document.addEventListener("DOMContentLoaded", init);
